const chartHeight=32;let fixedBarCount=49;const optimalValues={};let annualCustomAsset1Savings={},annualCustomAsset2Savings={},annualCustomAsset3Savings={},annualCustomAsset4Savings={},annualCustomAsset5Savings={};const calcSelectors=["retirement-age","expectancy","expected-stocks","expected-bonds","expected-btc","expected-cash","growth-rate","retirement-income","retirement-expenses","capital-gains","inflation-rate"],calcElementsAndRanges=[],inputValues={"btc-price":65e3},onlyNumbers=e=>+String(e).replace(/\D/g,""),formatPercent=e=>`${e}%`,formatToFixed=(e,t=0)=>+e.toFixed(t),formatCurrencyShort=(e,t=0)=>e>=1e12?`$${(e/1e12).toFixed(1)}T`:e>=1e9?`$${(e/1e9).toFixed(1)}B`:e>=1e6?`$${(e/1e6).toFixed(t)}M`:e>=1e3?`$${(e/1e3).toFixed()}K`:`$${e}`,formatCurrency=(e,t=0)=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:t,maximumFractionDigits:t}).format(e),getBitcoinPrice=async()=>{try{const e=await fetch("https://blockchain.info/ticker"),t=(await e.json()).USD.last;currentBtcPrice=t,console.log(`Current Bitcoin Price in USD: $${t}`)}catch(e){console.error("Error fetching Bitcoin price:",e)}},updateRangeSliderScale=(e,t,a,n,r,s,i)=>{const c=(n-a)/(fixedBarCount-1),u=Math.round((r-a)/c);if(i===u)return"#E9EBF2";if(s){if(i<u){const e=.24+.6*((u-i)/u);return`rgba(57, 158, 106, ${Math.min(e,1)})`}{const e=.24+.6*((i-u)/(fixedBarCount-u));return`rgba(255, 91, 59, ${Math.min(e,1)})`}}if(i<u){const e=.24+.6*((u-i)/u);return`rgba(255, 91, 59, ${Math.min(e,1)})`}{const e=.24+.6*((i-u)/(fixedBarCount-u));return`rgba(57, 158, 106, ${Math.min(e,1)})`}},updateAllRangesliders=()=>{calcElementsAndRanges.forEach((e=>{const{selector:t,slider:a,min:n,max:r,step:s}=e,i=(a.value,optimalValues[t]),c=optimalValues[`${t}-reversed`];optimalValues[`${t}-bars`].attr("fill",((e,t)=>updateRangeSliderScale(0,0,n,r,i,c,t)))}))},updateHandle=(e,t)=>{const a=document.querySelector(`#${e} .calc__slider__scale__item.is--mid`),n=document.querySelector(`#${e} input[type="range"]`),r=(t-n.min)/(n.max-n.min),s=r*n.offsetWidth,i=100*r;"true"===a.getAttribute("is-percent")?a.innerText=formatPercent(t):"true"===a.getAttribute("is-usd")?a.innerText=formatCurrencyShort(t):a.innerText=onlyNumbers(t),i>97&&(a.nextElementSibling.style.opacity=0),i<3&&(a.previousElementSibling.style.opacity=0),i>3&&i<97&&(a.nextElementSibling.style.opacity=1,a.previousElementSibling.style.opacity=1),a.style.left=s+"px",a.style.transform=`translateX(-${i}%)`},initRangeSliders=()=>{calcSelectors.forEach((e=>{const t=document.querySelector(`#${e}`);if(!t)return void console.error(`Slider container not found for selector: ${e}`);const a=t.querySelector(".calc__graph");if(!a)return void console.error(`Graph container not found for selector: ${e}`);let n=a.clientWidth;const r=window.innerWidth<768?3:4,s=d3.select(a).append("svg").attr("width",n).attr("height",32),i=t.querySelector(".calc__slider-range");if(!i)return void console.error(`Slider not found for selector: ${e}`);i.min,i.max;const c=d3.range(fixedBarCount),u=(n-r*(fixedBarCount-1))/fixedBarCount,l=d3.scaleBand().domain(c).range([0,n]).paddingInner(r/(u+r)),o=s.selectAll("rect").data(c).enter().append("rect").attr("x",(e=>l(e))).attr("y",0).attr("width",u).attr("height",32);optimalValues[`${e}-bars`]=o;const d=()=>{const t=+i.value;updateAllRangesliders(),updateHandle(e,t)};let p;i.addEventListener("input",(()=>{clearTimeout(p),p=setTimeout((()=>{let a=i.value;const n=t.querySelector(`#${e}-i`);"retirement-age"===e&&a<inputValues["current-age"]&&(a=inputValues["current-age"],i.value=a),inputValues[e]=onlyNumbers(a),d(),n&&("true"===n.getAttribute("is-percent")?n.value=formatPercent(a):"true"===n.getAttribute("is-usd")?n.value=formatCurrency(a):n.value=onlyNumbers(a)),runCalculations()}),10)})),d();const m=()=>{n=a.clientWidth;const e=(n-r*(fixedBarCount-1))/fixedBarCount;l.range([0,n]),o.attr("x",(e=>l(e))).attr("width",e),d()};let y;window.addEventListener("resize",(()=>{clearTimeout(y),y=setTimeout(m,100)}));const g=t.querySelector(`#${e}-i`);g&&g.addEventListener("blur",(()=>{setTimeout((()=>{inputValues[e]=onlyNumbers(g.value),i.value=onlyNumbers(g.value),d()}),10)}))}))};window.addEventListener("load",(async()=>{await getBitcoinPrice();const e={},t=new URLSearchParams(window.location.search);for(const[a,n]of t)e[a]=n;window.innerWidth<768&&(fixedBarCount=35),calcSelectors.forEach((e=>{const t=document.querySelector(`#${e}`);if(!t)return void console.error(`Slider container not found for selector: ${e}`);const a=t.querySelector(".calc__graph");if(!a)return void console.error(`Graph container not found for selector: ${e}`);let n=a.clientWidth;const r=window.innerWidth<768?3:4,s=d3.select(a).append("svg").attr("width",n).attr("height",32),i=t.querySelector(".calc__slider-range");if(!i)return void console.error(`Slider not found for selector: ${e}`);i.min,i.max;const c=d3.range(fixedBarCount),u=(n-r*(fixedBarCount-1))/fixedBarCount,l=d3.scaleBand().domain(c).range([0,n]).paddingInner(r/(u+r)),o=s.selectAll("rect").data(c).enter().append("rect").attr("x",(e=>l(e))).attr("y",0).attr("width",u).attr("height",32);optimalValues[`${e}-bars`]=o;const d=()=>{const t=+i.value;updateAllRangesliders(),updateHandle(e,t)};let p;i.addEventListener("input",(()=>{clearTimeout(p),p=setTimeout((()=>{let a=i.value;const n=t.querySelector(`#${e}-i`);"retirement-age"===e&&a<inputValues["current-age"]&&(a=inputValues["current-age"],i.value=a),inputValues[e]=onlyNumbers(a),d(),n&&("true"===n.getAttribute("is-percent")?n.value=formatPercent(a):"true"===n.getAttribute("is-usd")?n.value=formatCurrency(a):n.value=onlyNumbers(a)),runCalculations()}),10)})),d();const m=()=>{n=a.clientWidth;const e=(n-r*(fixedBarCount-1))/fixedBarCount;l.range([0,n]),o.attr("x",(e=>l(e))).attr("width",e),d()};let y;window.addEventListener("resize",(()=>{clearTimeout(y),y=setTimeout(m,100)}));const g=t.querySelector(`#${e}-i`);g&&g.addEventListener("blur",(()=>{setTimeout((()=>{inputValues[e]=onlyNumbers(g.value),i.value=onlyNumbers(g.value),d()}),10)}))})),calcSelectors.forEach((t=>{const a=document.querySelector(`#${t} .calc__slider-range`);calcElementsAndRanges.push({selector:t,slider:a,element:a,min:+a.getAttribute("min"),max:+a.getAttribute("max"),step:+a.getAttribute("step")}),a&&(e[t]&&(a.value=e[t]),a.dispatchEvent(new Event("input")),runCalculations())}));const a=document.querySelectorAll('.calc-field[is-age="true"]'),n=document.querySelector("#retirement-age-i");a.forEach((e=>{const t=+e.getAttribute("max-age"),a=+e.getAttribute("min-age");e.addEventListener("input",(()=>{e.value=onlyNumbers(e.value)})),e.addEventListener("blur",(()=>{let r=onlyNumbers(e.value);r>t&&(r=t),r<a&&(r=a),"retirement-age-i"===e.id&&e.value<inputValues["current-age"]&&(r=inputValues["current-age"]),"current-age"===e.id&&e.value>inputValues["retirement-age"]&&(n.value=r,n.dispatchEvent(new Event("blur"))),e.value=r,inputValues[e.id]=r;const s=e.closest(".calc-range__wrap")?.querySelector(".calc__slider-range");s?(s.value=r,s.dispatchEvent(new Event("input"))):runCalculations(),console.log(e.id,"input value: ",e.value,"max age: ",t,"min age:",a,"used value: ",r)}))}));document.querySelectorAll('.calc-field[is-percent="true"]').forEach((e=>{const t=+e.getAttribute("max-percent"),a=+e.getAttribute("min-percent");e.addEventListener("blur",(()=>{let n=onlyNumbers(e.value);n>t&&(n=t),n<a&&(n=a),e.value=formatPercent(n),inputValues[e.id]=n/100;const r=e.closest(".calc-range__wrap")?.querySelector(".calc__slider-range");r?(r.value=n,r.dispatchEvent(new Event("input"))):runCalculations(),console.log(e.id,"input value: ",e.value,"only numbers: ",onlyNumbers(e.value),"used value: ",n/100)}))}));document.querySelectorAll('.calc-field[is-usd="true"]').forEach((e=>{const t=+e.getAttribute("max-usd"),a=+e.getAttribute("min-usd");e.addEventListener("blur",(()=>{let n=onlyNumbers(e.value);n>t&&(n=t),n<a&&(n=a),e.value=formatCurrency(n),inputValues[e.id]=n;const r=e.closest(".calc-range__wrap")?.querySelector(".calc__slider-range");r?(r.value=n,r.dispatchEvent(new Event("input"))):runCalculations(),console.log(e.id,"input value: ",e.value,"only numbers: ",onlyNumbers(e.value),"used value: ",n)}))})),document.querySelectorAll(".calc-radio input").forEach((e=>{e.addEventListener("change",(()=>{inputValues[e.name]=e.value,runCalculations(),console.log(e.name,"radio value: ",e.value)}))})),document.querySelectorAll("input[init-value]").forEach((t=>{t.value=e[t.id]||t.getAttribute("init-value"),t.dispatchEvent(new Event("blur")),runCalculations()})),document.querySelectorAll('.calc-radio input[name="plan-type"]').forEach((e=>{e.addEventListener("change",(()=>{"custom"===document.querySelector('.calc-radio input[name="plan-type"]:checked').value?document.querySelector("#expected-btc").classList.remove("is--disabled"):document.querySelector("#expected-btc").classList.add("is--disabled")}))})),document.querySelectorAll("input[type='radio'][radio-initial='true']").forEach((t=>{const a=e[t.name];if(a===t.value)t.checked=!0,t.dispatchEvent(new Event("change",{bubbles:!0}));else{const e=t.closest(".calc-layout__radios").querySelector(`input[value="${a}"]`);e?(e.checked=!0,e.dispatchEvent(new Event("change",{bubbles:!0}))):(t.checked=!0,t.dispatchEvent(new Event("change",{bubbles:!0})))}runCalculations()})),document.querySelector("#share-btn").addEventListener("click",(function(){const e=this.textContent;this.textContent="Copied!",setTimeout((()=>this.textContent=e),2e3);const t=new URL(window.location.href),a=new URLSearchParams,n=["current-age","retirement-age","expectancy","balance-stocks","balance-bonds","balance-btc","additional-stocks","additional-bonds","additional-btc","expected-stocks","expected-bonds","expected-btc","plan-type","expected-cash","growth-rate","retirement-income","retirement-expenses","capital-gains","inflation-rate"];n.forEach((e=>{console.log(e,inputValues[e])})),n.forEach((e=>inputValues[e]&&a.append(e,inputValues[e]))),t.search=a.toString(),navigator.clipboard.writeText(t.toString())})),document.querySelector("#reset-btn").addEventListener("click",(()=>{document.querySelectorAll("input[init-value]").forEach((e=>{e.value=e.getAttribute("init-value"),e.dispatchEvent(new Event("blur"))})),calcSelectors.forEach((e=>{const t=document.querySelector(`#${e} .calc__slider-range`);t&&(t.value=t.getAttribute("value"),t.dispatchEvent(new Event("input")))})),document.querySelectorAll("input[type='radio'][radio-initial='true']").forEach((e=>{e.checked=!0,e.dispatchEvent(new Event("change",{bubbles:!0}))})),runCalculations()}));const r=document.querySelector(".secondary-popup"),s=document.querySelector(".secondary-popup .popup__close");let i=!1;document.addEventListener("click",(()=>{i||0})),s.addEventListener("click",(()=>{r.classList.remove("fade"),setTimeout((()=>r.classList.remove("show")),300)})),document.querySelectorAll(".calc-dropdown__list.is--initial").forEach((function(e){const t=e.closest(".calc-layout__custom").getAttribute("custom-value-order"),a=e.closest(".calc-dropdown").querySelector(".calc-dropdown__toggle__text"),n=e.getAttribute("custom-value-type");e.addEventListener("click",(function(e){if(!e.target.classList.contains("calc-dropdown__list__item"))return;a&&(a.textContent=e.target.textContent);const r=e.target.getAttribute("dropdown-value");console.log(n,t,r),inputValues[`custom-${n}-${t}`]=r,$(".calc-dropdown").trigger("w-close"),runCalculations()})),"1"===t&&(a&&(a.textContent=e.querySelector('.calc-dropdown__list__item[initial-value="true"]').textContent),inputValues[`custom-${n}-1`]=e.querySelector('.calc-dropdown__list__item[initial-value="true"]').getAttribute("dropdown-value")),e.classList.remove("is--initial")}));let c=1;document.querySelector("#add-asset-btn")?.addEventListener("click",(()=>{const e=document.querySelector("#add-asset-btn"),t=document.querySelectorAll(".calc-layout__custom"),a=document.querySelector(".calc-layout__custom:not(.is--active)");t.forEach((e=>e.classList.remove("is--last"))),a.classList.add("is--active");5===document.querySelectorAll(".calc-layout__custom.is--active").length&&e.classList.add("hidden"),a.style.order=c,c++})),document.querySelectorAll(".calc-layout__custom__controls-icon.is--remove").forEach((e=>{e.addEventListener("click",(function(){(e=>{const t=document.querySelector("#add-asset-btn"),a=e.closest(".calc-layout__custom"),n=a.getAttribute("custom-value-order");a.querySelectorAll(".calc-dropdown__toggle__text").forEach((e=>e.textContent=e.getAttribute("initial-toggle-text"))),a.querySelectorAll("input.calc-field").forEach((e=>e.value="$"+e.getAttribute("init-value"))),inputValues[`custom-asset-${n}`]=0,inputValues[`custom-status-${n}`]=0,inputValues[`custom-amount-${n}`]=0,inputValues[`custom-additional-${n}`]=0,a.classList.remove("is--active","is--last"),document.querySelectorAll(".calc-layout__custom").forEach((e=>e.classList.remove("is--last")));const r=document.querySelectorAll(".calc-layout__custom.is--active");let s,i=-2;r.forEach((e=>{const t=+e.style.order;t>i&&(i=t,s=e)})),s.classList.add("is--last"),t.classList.remove("hidden")})(e)}))})),window.dispatchEvent(new Event("resize"))}));const btcPricesS2F={2023:83667.67557239954,2024:686398.0127483337,2025:703741.9524243205,2026:721375.6236071566,2027:739301.4262968419,2028:5986997.015654025,2029:6060174.083947013,2030:6133945.0152537,2031:6208312.209574085,2032:49965761.24291532,2033:50266224.53526536,2034:50567889.953642786,2035:50870759.89804761,2036:408181178.5400824,2037:409398694.1478387,2038:410618628.40764976,2039:411840983.7195157,2040:3299624560.159754,2041:3304526099.867491,2042:3309432491.2793384,2043:3314343736.795295,2044:26534409444.738514,2045:26554078710.52289,2046:26573757694.115482,2047:26593446397.916298,2048:212826355165.1583,2049:212905158594.60263,2050:212983981474.06342,2051:213062823805.94064,2052:1704818018138.2832,2053:1705133484741.0745,2054:1705448990258.2983,2055:1705764534692.3552,2056:13647378572031.568,2057:13648640944365.16,2058:13649903394542.018,2059:13651165922564.541,2060:109214377726149.42,2061:109219428227481.05,2062:109224478884513.6,2063:109229529697249.48,2064:873856441296055.4,2065:873876645325528.8,2066:873896849666418.5,2067:873917054318726.8,2068:6991417254093309,2069:6991498074259649,2070:6991578895048836,2071:6991659716460872,2072:0xc6b75053c21058,2073:0xc6b79b99451880,2074:0xc6b7e6dedb22a8,2075:0xc6b83224842ee8,2076:0x635c2be3afeae80,2077:0x635c3eb5201ea00,2078:0x635c518692b2940,2079:0x635c645807a6d00,2080:357985909114264e4,2081:0x31ae3b94bf7da600,2082:0x31ae40491dc4d200,2083:0x31ae44fd7c580600,2084:0x18d723abd5df11000,2085:2863903825633595e4,2086:2863905894728015e4,2087:0x18d727331d3144000,2088:2291127198697211e5,2089:2291128026335876e5,2090:229112885397474e6,2091:0xc6b94c6a676750000,2092:1832904076346728e6,2093:1832904407402453e6,2094:1832904738458218e6,2095:1832905069514023e6,2096:14663241880335521e6,2097:14663243204558938e6,2098:14663244528782437e6,2099:14663245853006015e6,2100:11730597212094267e7,2101:11730597741783739e7,2102:11730598271473226e7,2103:1173059880116273e8,2104:9384479252805988e8,2105:9384479464681798e8,2106:938447967655761e9,2107:9384479888433425e8,2108:7507583995497068e9,2109:7507584080247396e9,2110:7507584164997724e9,2111:7507584249748053e9,2112:6006067433698574e10,2113:60060674675987065e9,2114:6006067501498839e10,2115:6006067535398971e10,2116:48048540418792296e10,2117:48048540554392825e10,2118:4804854068999335e11,2119:4804854082559388e11,2120:38438832714715317e11,2121:3843883276895553e12,2122:38438832823195746e11,2123:3843883287743595e12,2124:3075106632364485e13,2125:3075106634586495e13,2126:3075106636808505e13,2127:3075106639030515e13,2128:2460085306062612e14,2129:2460085306646612e14,2130:2460085307230612e14,2131:2460085307814612e14,2132:1.9680682457644895e30,2133:1.9680682458004896e30,2134:1.9680682458364897e30,2135:1.9680682458724895e30,2136:15744545966091917e15,2137:15744545966101917e15,2138:15744545966111917e15,2139:15744545966121917e15,2140:12595636772888455e16,2141:12595636772889454e16,2142:12595636772890454e16,2143:12595636772891456e16,2144:10076509418312764e17,2145:10076509418312863e17,2146:10076509418312964e17,2147:10076509418313064e17,2148:806120753465051e19,2149:806120753465052e19,2150:806120753465053e19},btcPricesPowerLaw=(()=>{const e=[{time:1,price:.03},{time:2,price:1.17},{time:3,price:9.91},{time:4,price:45.2},{time:5,price:146.7},{time:6,price:383.87},{time:7,price:865.75},{time:8,price:1751.3},{time:9,price:3260.17},{time:10,price:5684.04},{time:11,price:9398.21},{time:12,price:14873.64},{time:13,price:22689.36},{time:14,price:33545.07},{time:15,price:89e3}].map((({time:e,price:t})=>({x:Math.log(e),y:Math.log(t)}))),t=e.length,a=e.reduce(((e,t)=>e+t.x),0),n=e.reduce(((e,t)=>e+t.y),0),r=(t*e.reduce(((e,t)=>e+t.x*t.y),0)-a*n)/(t*e.reduce(((e,t)=>e+t.x*t.x),0)-a*a),s=Math.exp((n-r*a)/t),i={};for(let e=0;e<150;e++){i[2010+e]=s*Math.pow(e+1,r)}return i})(),currentYear=(new Date).getFullYear();let currentBtcPrice=65e3;const btcPricesBtc24=()=>{const e=currentYear,t={[e]:currentBtcPrice};for(let a=1;a<=150;a++){const n=Math.max(50-2.5*(a-1),20),r=t[e+(a-1)];t[e+a]=r*(1+n/100)}return t},btcPricesCustom=e=>{const t={[currentYear]:currentBtcPrice};for(let a=1;a<=150;a++){const n=t[currentYear+a-1];t[currentYear+a]=n*(1+e/100)}return t},sidebarElements={};document.addEventListener("DOMContentLoaded",(()=>{sidebarElements.retireBy=document.querySelector("#res-retire-by"),sidebarElements.portfolioAtRetirement=document.querySelector("#res-portfolio-retirement"),sidebarElements.btcAtRetirement=document.querySelector("#res-btc-retirement"),sidebarElements.btcPriceAtRetirement=document.querySelector("#res-btc-price-retirement"),sidebarElements.monthlyBudget=document.querySelector("#res-budget-monthly"),sidebarElements.annualBudget=document.querySelector("#res-budget-year"),sidebarElements.yearsOfWithdrawals=document.querySelector("#res-years-of-withdrawals"),sidebarElements.portfolioAtDeath=document.querySelector("#res-portfolio-at-death"),sidebarElements.successMessage=document.querySelector('.notification[notification="success"]'),sidebarElements.errorMessage=document.querySelector('.notification[notification="fail"]'),sidebarElements.mobileUnderline=document.querySelector(".calc-mobile__underline")}));const runCalculations=()=>{if(["btc-price","current-age","balance-stocks","balance-bonds","balance-btc","additional-stocks","additional-bonds","additional-btc","retirement-age","expectancy","expected-stocks","expected-bonds","expected-cash","expected-btc","growth-rate","retirement-income","retirement-expenses","capital-gains","inflation-rate","plan-type"].filter((e=>!inputValues[e]&&0!==inputValues[e])).length>0)return;const e=inputValues["current-age"],t=(e,t)=>e[t],a=(e,t,a,n=!1,r=!0,s=inputValues["growth-rate"],i=inputValues["inflation-rate"])=>{const c={};c[currentYear]=e;for(let e=1;e<=a;e++){const a=c[currentYear+(e-1)],u=currentYear+e;if(r&&u>t)continue;const l=a*(1+(n?i:s)/100);c[u]=l}return c},n=()=>{let t=0;for(i=1;i<=5;i++)t+=+inputValues[`custom-additional-${i}`]||0;return a(t,currentYear+inputValues["retirement-age"]-e,inputValues.expectancy,!1,!0)},r=e=>{switch(e){case"stocks":return 1+inputValues["expected-stocks"]/100;case"bonds":return 1+inputValues["expected-bonds"]/100;case"btc":return 1+inputValues["expected-btc"]/100;case"other":return 1+inputValues["expected-cash"]/100;default:return 1}},s=(e,t,a,n=inputValues["capital-gains"])=>{const r={};for(let s=1;s<=a;s++){const a=currentYear+s;r[a]=a>t?e[a]/(1-n/100):0}return r},c=(t,a,n,s,i,c,u,l,o,d,p,m,y=!1)=>{const g={},V={},h={},x={},b={},f={},v={},S=(w=m,inputValues["balance-btc"],"btc24"===inputValues["plan-type"]?btcPricesBtc24():"power-law"===inputValues["plan-type"]?btcPricesPowerLaw:"custom"===inputValues["plan-type"]?btcPricesCustom(w):btcPricesS2F);var w;const E={},C={},_=o,A=d,L=inputValues["balance-stocks"],$=inputValues["balance-bonds"],q=inputValues["balance-btc"];let k=!1;const Y=inputValues["custom-amount-1"]||0,B=inputValues["custom-amount-2"]||0,M=inputValues["custom-amount-3"]||0,R=inputValues["custom-amount-4"]||0,P=inputValues["custom-amount-5"]||0,T=inputValues["custom-asset-1"],N=inputValues["custom-asset-2"],F=inputValues["ccustom-asset-3"],W=inputValues["custom-asset-4"],D=inputValues["custom-asset-5"],O=inputValues["custom-status-1"],I=inputValues["custom-status-2"],U=inputValues["custom-status-3"],z=inputValues["custom-status-4"],j=inputValues["custom-status-5"],G={},H={},Z={},K={},X={},J={},Q={},ee={},te={},ae={};g[currentYear]=$+L+q+Y+B+M+R+P,V[currentYear]=q,x[currentYear]=L,f[currentYear]=$,G[currentYear]=Y,H[currentYear]=B,Z[currentYear]=M,K[currentYear]=R,X[currentYear]=P,C[currentYear]=g[currentYear];for(let c=1;c<=u;c++){const u=currentYear+c,o=e+c,d=S[u],p=g[u-1]||0;let m=0,w=0,L=0,$=0,q=0,Y=0,B=0,M=0,R=t[u]-a[u]||0;if(u>l&&p>0)if(0!==R){const e=V[u-1]||0,t=x[u-1]||0,a=f[u-1]||0,n=G[u-1]||0,r=H[u-1]||0,s=Z[u-1]||0,i=K[u-1]||0,c=X[u-1]||0;if(o>=60){k=!1,y&&console.log("Age is 60 or older, no penalty, sell proportionally");m=R*(e/p),w=R*(t/p),L=R*(a/p),$=R*(n/p),q=R*(r/p),Y=R*(s/p),B=R*(i/p),M=R*(c/p),R>0&&(m=Math.min(m,e),w=Math.min(w,t),L=Math.min(L,a),$=Math.min($,G[u-1]),q=Math.min(q,H[u-1]),Y=Math.min(Y,Z[u-1]),B=Math.min(B,K[u-1]),M=Math.min(M,X[u-1]))}else{const l=Math.max(p-("roth"!==O?n:0)-("roth"!==I?r:0)-("roth"!==U?s:0)-("roth"!==z?i:0)-("roth"!==j?c:0),0),o=Math.max(p-l,0);if(l<R){y&&console.log("Non-roth assets are NOT enough to cover the withdrawal",formatCurrency(l)),k=!0,o+l<R&&y&&console.log("NOT enought Roth assets to cover remaining withdrawal",formatCurrency(l),"Roth assets",formatCurrency(o)),m=e,w=t,L=a,$="roth"!==O?n:0,q="roth"!==I?r:0,Y="roth"!==U?s:0,B="roth"!==z?i:0,M="roth"!==j?c:0;let d=Math.max(0,R-l);if(o>0&&d>0){const e=Math.min(d,o);if("roth"===O){const t=Math.min(e*(n/o),n);$+=t,d-=t}if("roth"===I){const t=Math.min(e*(r/o),r);q+=t,d-=t}if("roth"===U){const t=Math.min(e*(s/o),s);Y+=t,d-=t}if("roth"===z){const t=Math.min(e*(i/o),i);B+=t,d-=t}if("roth"===j){const t=Math.min(e*(c/o),c);M+=t,d-=t}}R>0&&($=Math.min($,G[u-1]),q=Math.min(q,H[u-1]),Y=Math.min(Y,Z[u-1]),B=Math.min(B,K[u-1]),M=Math.min(M,X[u-1]))}else{k=!1,y&&console.log("Non-roth assets are enough to cover the withdrawal","Non-roth assets",formatCurrency(l));m=R*(e/p),w=R*(t/p),L=R*(a/p),$=R*(n/p),q=R*(r/p),Y=R*(s/p),B=R*(i/p),M=R*(c/p),R>0&&(m=Math.min(m,e),w=Math.min(w,t),L=Math.min(L,a),$=Math.min($,G[u-1]),q=Math.min(q,H[u-1]),Y=Math.min(Y,Z[u-1]),B=Math.min(B,K[u-1]),M=Math.min(M,X[u-1]))}}}else console.log("Year:",u,"No withdrawals needed");if(p>0){h[u]=-m,b[u]=-w,v[u]=-L,J[u]=-$,Q[u]=-q,ee[u]=-Y,te[u]=-B,ae[u]=-M;const e=d/S[u-1];V[u]=(V[u-1]||0)*e+(n[u]||0)+h[u],x[u]=(x[u-1]||0)*(1+_/100)+(s[u]||0)+b[u],f[u]=(f[u-1]||0)*(1+A/100)+(i[u]||0)+v[u],G[u]=G[u-1]*r(T)+(annualCustomAsset1Savings[u]||0)+J[u],H[u]=H[u-1]*r(N)+(annualCustomAsset2Savings[u]||0)+Q[u],Z[u]=Z[u-1]*r(F)+(annualCustomAsset3Savings[u]||0)+ee[u],K[u]=K[u-1]*r(W)+(annualCustomAsset4Savings[u]||0)+te[u],X[u]=X[u-1]*r(D)+(annualCustomAsset5Savings[u]||0)+ae[u],g[u]=Math.max(V[u]+x[u]+f[u]+G[u]+H[u]+Z[u]+K[u]+X[u]-Math.max(R,0),0)}else V[u]=0,x[u]=0,f[u]=0,g[u]=0,G[u]=0,H[u]=0,Z[u]=0,K[u]=0,X[u]=0;g[u]<=0?E[u]=!1:E[u]=!0;const P=.6*C[u-1]*(1+_/100)+(s[u]||0)+b[u],ne=.4*C[u-1]*(1+A/100)+(i[u]||0)+v[u];if(u>l){const e=P+ne,a=R*(e/g[u]),n=.6*a,r=.4*a;if(C[u-1]>0&&t[u]<e){const e=P-n,t=ne-r;C[u]=Math.max(e+t,0)}else C[u]=0}else C[u]=P+ne;isNaN(g[u])&&console.error("NaN detected in year:",u,{btcBalance:V[u],stocksBalance:x[u],bondsBalance:f[u],totalBalance:g[u],btcPrice:d,previousBtcPrice:S[u-1],previousTotalBalance:p,netWithdrawal:R,withdrawals:{btc:h[u],stocks:b[u],bonds:v[u]}}),y&&console.log(`Year ${u}, Age: ${inputValues["current-age"]+c}  Total Balance: ${formatCurrency(g[u])}, Total withdrawal: ${formatCurrency(Math.max(R,0))} \n\n        Roth tax penalty: ${k} \n\n        Custom asset 1: ${formatCurrency(G[u])}, withdrawal: ${formatCurrency(J[u])} \n\n        Custom asset 2: ${formatCurrency(H[u])}, withdrawal: ${formatCurrency(Q[u])} \n\n        Custom asset 3: ${formatCurrency(Z[u])}, withdrawal: ${formatCurrency(ee[u])} \n\n        Custom asset 4: ${formatCurrency(K[u])}, withdrawal: ${formatCurrency(te[u])} \n\n        Custom asset 5: ${formatCurrency(X[u])}, withdrawal: ${formatCurrency(ae[u])} \n\n        BTC Balance: ${formatCurrency(V[u])}, withdrawal: ${formatCurrency(h[u],2)}, price: ${formatCurrency(d)} \n\n        Stocks Balance: ${formatCurrency(x[u])}, withdrawal: ${formatCurrency(b[u])} \n\n        Bonds Balance: ${formatCurrency(f[u])}, withdrawal: ${formatCurrency(v[u])} \n\n        60/40 Portfolio: ${formatCurrency(C[u])} \n\n        Retirement Success: ${E[u]?"Yes":"No"} \n\n        `)}return{totalBalances:g,btcBalance:V,btcSold:h,stocksBalance:x,stocksSold:b,bondsBalance:f,bondsSold:v,btcPrices:S,retirementSuccessStatus:E,portfolio60_40:C}},u=a(inputValues["retirement-expenses"],currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy,!0,!1),l=(a(inputValues["additional-cash"],currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy,!1,!1),a(inputValues["additional-bonds"],currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy,!1,!0)),o=a(inputValues["additional-stocks"],currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy,!1,!0);n();annualCustomAsset1Savings=a(inputValues["additional-custom-asset-1"],currentYear+(inputValues["retirement-age"]-e),r(inputValues["custom-asset-1-status"]),!1,!0),annualCustomAsset2Savings=a(inputValues["additional-custom-asset-2"],currentYear+(inputValues["retirement-age"]-e),r(inputValues["custom-asset-2-status"]),!1,!0),annualCustomAsset3Savings=a(inputValues["additional-custom-asset-3"],currentYear+(inputValues["retirement-age"]-e),r(inputValues["custom-asset-3-status"]),!1,!0),annualCustomAsset4Savings=a(inputValues["additional-custom-asset-4"],currentYear+(inputValues["retirement-age"]-e),r(inputValues["custom-asset-4-status"]),!1,!0),annualCustomAsset5Savings=a(inputValues["additional-custom-asset-5"],currentYear+(inputValues["retirement-age"]-e),r(inputValues["custom-asset-5-status"]),!1,!0);const d=a(inputValues["additional-btc"],currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy,!1,!0),p=a(inputValues["retirement-income"],currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy,!0,!1),m=s(u,currentYear+(inputValues["retirement-age"]-e),inputValues.expectancy),{totalBalances:y,btcBalance:g,btcSold:V,stocksBalance:h,stocksSold:x,bondsBalance:b,bondsSold:f,btcPrices:v,retirementSuccessStatus:S,portfolio60_40:w}=c(m,p,d,o,l,0,inputValues.expectancy,currentYear+(inputValues["retirement-age"]-e),inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"],!0),E=(C=u,A=currentYear+(inputValues["retirement-age"]-e),C[A]);var C,A;const L=((e,t)=>e[t])(y,currentYear+(inputValues["retirement-age"]-e)),$=t(y,currentYear-e+inputValues.expectancy);_.throttle((()=>{calcElementsAndRanges.forEach((r=>{const i=r.selector,u=r.min,l=r.max,o=r.step;if("retirement-age"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(p-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["retirement-age-reversed"]=!1}else if("expectancy"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear-e+p,m=a(inputValues["retirement-expenses"],currentYear+(inputValues["retirement-age"]-e),p,!0,!1),y=s(m,currentYear+(inputValues["retirement-age"]-e),p),g=a(inputValues["retirement-income"],currentYear+(inputValues["retirement-age"]-e),p,!0,!1),V=a(inputValues["additional-btc"],currentYear+(inputValues["retirement-age"]-e),p,!1,!0),h=a(inputValues["additional-stocks"],currentYear+(inputValues["retirement-age"]-e),p,!1,!0),x=a(inputValues["additional-bonds"],currentYear+(inputValues["retirement-age"]-e),p,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,p,currentYear+(inputValues["retirement-age"]-e),inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,o)<=0){optimalValues[i]=p-1,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&d.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.add("is--gray"),d.classList.remove("is--gray"))}optimalValues["expectancy-reversed"]=!0}else if("expected-stocks"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,p,inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["expected-stocks-reversed"]=!1}else if("expected-bonds"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],p,inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["expected-bonds-reversed"]=!1}else if("expected-cash"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],0,inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["expected-cash-reversed"]=!1}else if("expected-btc"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],p));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["expected-btc-reversed"]=!1}else if("growth-rate"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1,p),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1,p),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0,p),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0,p),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0,p),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["growth-rate-reversed"]=!1}else if("retirement-income"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=2*o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(p,o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)>0){optimalValues[i]=p,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&r.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.remove("is--gray"),d.classList.add("is--gray"))}optimalValues["retirement-income-reversed"]=!1}else if("retirement-expenses"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=2*o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(p,o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)<=0){optimalValues[i]=p-1,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&d.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.add("is--gray"),d.classList.remove("is--gray"))}optimalValues["retirement-expenses-reversed"]=!0}else if("capital-gains"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1),y=s(m,o,inputValues.expectancy,p),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)<=0){optimalValues[i]=p-1,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&d.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.add("is--gray"),d.classList.remove("is--gray"))}optimalValues["capital-gains-reversed"]=!0}else if("inflation-rate"===i){const r=document.querySelector(`#${i} .calc-range__info-text.is--red`),d=document.querySelector(`#${i} .calc-range__info-text.is--green`);for(let p=u;p<=l;p+=o){const o=currentYear+(inputValues["retirement-age"]-e),m=a(inputValues["retirement-expenses"],o,inputValues.expectancy,!0,!1,inputValues["growth-rate"],p),y=s(m,o,inputValues.expectancy),g=a(inputValues["retirement-income"],o,inputValues.expectancy,!0,!1,inputValues["growth-rate"],p),V=a(inputValues["additional-btc"],o,inputValues.expectancy,!1,!0,inputValues["growth-rate"],p),h=a(inputValues["additional-stocks"],o,inputValues.expectancy,!1,!0,inputValues["growth-rate"],p),x=a(inputValues["additional-bonds"],o,inputValues.expectancy,!1,!0,inputValues["growth-rate"],p),{totalBalances:b}=(n(),c(y,g,V,h,x,0,inputValues.expectancy,o,inputValues["expected-stocks"],inputValues["expected-bonds"],inputValues["expected-cash"],inputValues["expected-btc"]));if(t(b,currentYear-e+inputValues.expectancy)<=0){optimalValues[i]=p-1,d.classList.remove("is--gray"),r.classList.remove("is--gray"),p===u&&d.classList.add("is--gray");break}p>=l&&(optimalValues[i]=l,r.classList.add("is--gray"),d.classList.remove("is--gray"))}optimalValues["inflation-rate-reversed"]=!0}})),updateAllRangesliders()}),100,{trailing:!0})(),((e,t,a,n,r,s,i)=>{setTimeout((()=>{const c=((e,t)=>e[t])(a,currentYear+(inputValues["retirement-age"]-e));sidebarElements.retireBy&&(sidebarElements.retireBy.value=inputValues["retirement-age"]),sidebarElements.portfolioAtRetirement&&(sidebarElements.portfolioAtRetirement.value=formatCurrency(i)),sidebarElements.btcAtRetirement&&(sidebarElements.btcAtRetirement.value="â‚¿"+formatCurrency(((e,t)=>e[t])(t,currentYear+(inputValues["retirement-age"]-e))/c,3).replace("$","")),sidebarElements.btcPriceAtRetirement&&(sidebarElements.btcPriceAtRetirement.value=formatCurrency(c)),sidebarElements.monthlyBudget&&(sidebarElements.monthlyBudget.value=formatCurrency(n/12)),sidebarElements.annualBudget&&(sidebarElements.annualBudget.value=formatCurrency(n)),sidebarElements.yearsOfWithdrawals&&(sidebarElements.yearsOfWithdrawals.value=formatToFixed(((e,t,a)=>{let n=0;for(let r=t;r<=a&&e[r];r++)n++;return n})(r,currentYear+(inputValues["retirement-age"]-e),currentYear-e+inputValues.expectancy),1)),sidebarElements.portfolioAtDeath&&(sidebarElements.portfolioAtDeath.value=formatCurrency(s)),s<=0?(sidebarElements.successMessage.classList.add("hidden"),sidebarElements.errorMessage.classList.remove("hidden"),sidebarElements.mobileUnderline.classList.remove("is--green")):(sidebarElements.successMessage.classList.remove("hidden"),sidebarElements.errorMessage.classList.add("hidden"),sidebarElements.mobileUnderline.classList.add("is--green"))}),50)})(e,g,v,E,S,$,L),updateMainChart(y,currentYear-e+inputValues.expectancy,e,w)};let chart,overviewChart,chartInited=!1,chartElements={};const updateMainChart=(e,t,a,n)=>{chartInited||(chartElements.resultsWrap=document.querySelector(".chart-wrap .chart-info"),chartElements.resultAge=document.querySelector("#chart-res-age"),chartElements.resultBtc=document.querySelector("#chart-res-btc"),chartElements.result60_40=document.querySelector("#chart-res-6040"),chartElements.resultRoth=document.querySelector("#chart-res-roth"),chartElements.rothWrap=document.querySelector(".chart-info #roth-wrap"),chartElements.resultDifference=document.querySelector("#chart-res-diff"));const r=[];for(let e=currentYear;e<=t;e++){const n=a+(e-currentYear);(e-currentYear)%10==0||e===t?r.push(n.toString()):r.push("")}const s=Object.fromEntries(Object.entries(e).filter((([e])=>Number(e)<=t))),i=Object.fromEntries(Object.entries(n).filter((([e])=>Number(e)<=t))),c={data:Object.values(s),borderColor:"#399E6A",fill:!1,borderWidth:2,tension:.4,pointRadius:0},u={data:Object.values(i),borderColor:"#0095D6",backgroundColor:"#CDEFFF33",fill:!0,borderWidth:2,tension:.4,pointRadius:0},l=document.querySelector(".calculator-chart").getContext("2d"),o=document.querySelector(".overview-chart").getContext("2d");Chart.defaults.font.family="Inter, sans-serif",Chart.defaults.font.size=12,Chart.defaults.font.weight=600;const d={type:"line",data:{labels:r,datasets:[c,u]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!1,border:{display:!0,color:"#0A5999",width:2},grid:{display:!1,drawOnChartArea:!1,drawBorder:!1,drawTicks:!1,offset:!1},title:{display:!0,text:"AGE",color:"#0A5999",font:{size:16,weight:"bold"}},ticks:{color:"#0A5999",size:12,weight:"bold",family:"Inter",autoSkip:!1,padding:18,rotation:0,minRotation:0,maxRotation:0,align:"start",crossAlign:"far"}},y:{beginAtZero:!1,grid:{display:!0,color:"#CCEAF7",drawBorder:!1,drawTicks:!1,offset:!1},border:{display:!0,color:"#0A5999",width:2},ticks:{padding:0,color:"#0A5999",size:12,weight:"bold",family:"Inter",callback:e=>formatCurrencyShort(e),padding:8},title:{display:!1}}},layout:{padding:10}},plugins:[{id:"corsair",defaults:{width:1,color:"#CCEAF7",dash:[3,3]},afterInit:(e,t,a)=>{e.corsair={x:0,y:0}},afterEvent:(e,t)=>{const{inChartArea:a}=t,{type:n,x:r,y:s}=t.event;e.corsair={x:r,y:s,draw:a},e.draw()},beforeDatasetsDraw:(e,t,a)=>{const{ctx:n}=e,{top:r,bottom:s}=e.chartArea,{x:i,draw:c}=e.corsair;c&&(n.save(),n.beginPath(),n.lineWidth=a.width,n.strokeStyle=a.color,n.moveTo(i,s),n.lineTo(i,r),n.stroke(),n.restore())}}]},p={type:"line",data:{labels:r,datasets:[c,u]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!1,border:{display:!0,color:"#0A5999",width:2},grid:{display:!1,drawOnChartArea:!1,drawBorder:!1,drawTicks:!1,offset:!1},title:{display:!0,text:"AGE",color:"#0A5999",padding:10,font:{size:8,weight:"bold"}},ticks:{display:!1}},y:{beginAtZero:!1,grid:{display:!0,color:"#CCEAF7",drawBorder:!1,drawTicks:!1,offset:!1},border:{display:!0,color:"#0A5999",width:2},ticks:{display:!1},title:{display:!1}}},layout:{padding:{top:0,right:0,bottom:0,left:1}}}};chartInited?(chart.data.labels=r,chart.data.datasets=d.data.datasets,chart.options=d.options,chart.update("none"),overviewChart.data.labels=r,overviewChart.data.datasets=p.data.datasets,overviewChart.options=p.options,overviewChart.update("none")):(chart=new Chart(l,d),overviewChart=new Chart(o,p),l.canvas.addEventListener("mousemove",(e=>{const t=chart.getElementsAtEventForMode(e,"index",{intersect:!1});if(t.length){const e=t[0].index,a=inputValues["current-age"]+e,n=chart.data.datasets[0].data[e],r=chart.data.datasets[1].data[e],s=chart.data.datasets[2]?.data[e]||0;chartElements.resultAge.textContent=a,chartElements.resultBtc.textContent=formatCurrency(n),chartElements.result60_40.textContent=formatCurrency(r),chartElements.resultRoth.textContent=formatCurrency(s),chartElements.resultDifference.textContent=formatCurrency(n-r),chartElements.resultsWrap.classList.remove("is--inactive")}else chartElements.resultsWrap.classList.add("is--inactive")})),l.canvas.addEventListener("mouseleave",(()=>{chartElements.resultsWrap.classList.add("is--inactive")})),chartInited=!0)};
